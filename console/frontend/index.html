<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/agent-icon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>讯飞星辰Agent开发平台-官网</title>
    <meta
      name="description"
      content="新一代智能体Agent开发平台，支持通过提示词Prompt、工作流Workflow灵活创建专业智能体。平台已整合丰富的模型、插件、MCP Server，支持一站式效果测评，助力开发者快速搭建生产级智能体。创建后可发布到讯飞星火App、微信公众号，或发布成API、MCP Server。"
    />
    <meta
      name="keywords"
      content="讯飞星辰、星火智能体、Agent开发、智能体、大模型、Maas微调、RAG、MCP Server、MCP托管、工作流编排、AI插件、AI工具、AI应用、大模型应用、星火大模型"
    />
    <%- ssoScript %>
  </head>

  <body>
    <div id="root"></div>
    <script>
      const RELOAD_FLAG = '__VITE_PRELOAD_FIXED_AT__';
      let reloading = false;

      function safeReload() {
        if (reloading) return;
        reloading = true;

        const now = Date.now();
        const last = Number(sessionStorage.getItem(RELOAD_FLAG) || '0');
        if (now - last < 5000) return; // 5s 内只触发一次，防抖+防死循环
        sessionStorage.setItem(RELOAD_FLAG, String(now));

        // 缓存破坏：追加时间戳参数，避免再次请求旧 chunk
        const url = new URL(window.location.href);
        url.searchParams.set('v', String(now));
      }

      function suppressAndReload(e) {
        console.log('suppressAndReload error:', e);
        e?.preventDefault?.();
        e?.stopPropagation?.();
        e?.stopImmediatePropagation?.();
        safeReload();
      }

      function suppressAndReload(e) {
        console.log('suppressAndReload error:', e);
        e?.preventDefault?.();
        e?.stopPropagation?.();
        e?.stopImmediatePropagation?.();
        safeReload();
      }

      // 专属事件：Vite 预加载失败
      window.addEventListener('vite:preloadError', suppressAndReload, true);

      // 一些浏览器/场景下的模块导入失败错误
      window.addEventListener(
        'error',
        e => {
          const msg = e?.message || '';
          if (
            msg.includes('Failed to fetch dynamically imported module') ||
            msg.includes('Importing a module script failed')
          ) {
            suppressAndReload(e);
          }
        },
        true
      );

      // Promise 拒绝形态的动态 import 失败
      window.addEventListener('unhandledrejection', e => {
        const msg = String(e?.reason?.message || e?.reason || '');
        if (msg.includes('Failed to fetch dynamically imported module')) {
          suppressAndReload(e);
        }
      });
    </script>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>
